<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identity Generator — Clarity Demo</title>
    <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a1628;
            --bg-panel: #111d32;
            --bg-card: #182841;
            --bg-card-hover: #1e3352;
            --text-white: #f1f5f9;
            --text-muted: #94a3b8;
            --text-dim: #64748b;
            --accent: #61F393;
            --accent-dim: rgba(97, 243, 147, 0.15);
            --danger: #EF4444;
            --danger-dim: rgba(239, 68, 68, 0.15);
            --border: rgba(255, 255, 255, 0.06);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ── Header ── */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 32px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-logo { height: 28px; opacity: 0.9; }

        .header-divider {
            width: 1px;
            height: 20px;
            background: var(--text-dim);
            opacity: 0.3;
        }

        .header-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .header-back {
            font-size: 0.85rem;
            color: var(--text-dim);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }

        .header-back:hover { color: var(--text-white); }

        /* ── Attack Timeline ── */
        .attack-timeline {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            padding: 12px 32px;
            border-bottom: 1px solid var(--border);
            background: rgba(10, 22, 40, 0.5);
            flex-shrink: 0;
        }

        .timeline-step {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: var(--text-dim);
            transition: color 0.3s;
        }

        .timeline-step .step-num {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1.5px solid var(--text-dim);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            transition: all 0.3s;
        }

        .timeline-step.active {
            color: var(--danger);
        }

        .timeline-step.active .step-num {
            border-color: var(--danger);
            background: var(--danger);
            color: white;
        }

        .timeline-step.done {
            color: var(--accent);
        }

        .timeline-step.done .step-num {
            border-color: var(--accent);
            background: var(--accent);
            color: var(--bg-dark);
        }

        .timeline-connector {
            width: 60px;
            height: 1px;
            background: var(--text-dim);
            margin: 0 12px;
            opacity: 0.3;
            position: relative;
            overflow: hidden;
        }

        .timeline-connector.active::after {
            content: '';
            position: absolute;
            left: 0; top: 0;
            height: 100%;
            width: 100%;
            background: var(--danger);
            animation: connectorFill 0.4s ease forwards;
        }

        .timeline-connector.done::after {
            content: '';
            position: absolute;
            left: 0; top: 0;
            height: 100%; width: 100%;
            background: var(--accent);
        }

        @keyframes connectorFill {
            from { width: 0; }
            to { width: 100%; }
        }

        /* Timer */
        .attack-timer {
            position: absolute;
            right: 32px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dim);
            display: none;
        }

        .attack-timer.running {
            display: block;
            color: var(--danger);
        }

        .attack-timer.finished {
            display: block;
            color: var(--accent);
        }

        .attack-timeline { position: relative; }

        /* ── Main Layout ── */
        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ── Left Panel ── */
        .left-panel {
            width: 380px;
            flex-shrink: 0;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .company-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid var(--border);
        }

        .company-logo-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 6px;
        }

        .company-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            color: white;
        }

        .company-name { font-size: 1.15rem; font-weight: 700; }

        .company-subtitle {
            font-size: 0.78rem;
            color: var(--text-dim);
            margin-top: 4px;
            padding-left: 52px;
        }

        .jobs-label {
            padding: 14px 24px 8px;
            font-size: 0.68rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-dim);
        }

        .job-list {
            padding: 0 14px 14px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .job-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 18px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .job-card:hover {
            background: var(--bg-card-hover);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .job-card.active {
            border-color: var(--danger);
            background: var(--danger-dim);
        }

        .job-card.active::before {
            content: '';
            position: absolute;
            left: 0; top: 50%;
            transform: translateY(-50%);
            width: 3px; height: 60%;
            background: var(--danger);
            border-radius: 0 2px 2px 0;
        }

        .job-title { font-size: 0.92rem; font-weight: 700; margin-bottom: 3px; }
        .job-team { font-size: 0.78rem; color: var(--text-muted); margin-bottom: 8px; }

        .job-meta {
            display: flex;
            gap: 12px;
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .job-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Job requirements (shown during scan) */
        .job-requirements {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.05);
            display: none;
            flex-wrap: wrap;
            gap: 5px;
        }

        .job-card.active .job-requirements {
            display: flex;
        }

        .req-tag {
            font-size: 0.65rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(239, 68, 68, 0.08);
            color: var(--text-dim);
            border: 1px solid rgba(239, 68, 68, 0.1);
            transition: all 0.3s;
        }

        .req-tag.extracted {
            background: var(--danger-dim);
            color: var(--danger);
            border-color: rgba(239, 68, 68, 0.3);
        }

        /* ── Right Panel ── */
        .right-panel {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 28px;
            position: relative;
            overflow-y: auto;
        }

        /* Placeholder */
        .placeholder { text-align: center; color: var(--text-dim); }

        .placeholder-icon {
            width: 80px; height: 80px;
            border: 2px dashed rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .placeholder-icon svg {
            width: 36px; height: 36px;
            stroke: var(--text-dim);
            opacity: 0.4;
        }

        .placeholder h3 {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-muted);
        }

        .placeholder p { font-size: 0.85rem; }

        /* Scanning overlay */
        .scan-overlay {
            position: absolute;
            inset: 0;
            background: rgba(10, 22, 40, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .scan-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .scan-ring-outer {
            width: 100px; height: 100px;
            position: relative;
            margin-bottom: 28px;
        }

        .scan-ring {
            position: absolute;
            inset: 0;
            border: 2px solid transparent;
            border-top-color: var(--danger);
            border-right-color: var(--danger);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        .scan-ring-inner {
            position: absolute;
            inset: 12px;
            border: 1.5px solid transparent;
            border-bottom-color: rgba(239, 68, 68, 0.4);
            border-left-color: rgba(239, 68, 68, 0.4);
            border-radius: 50%;
            animation: spin 1.2s linear infinite reverse;
        }

        .scan-crosshair {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 12px; height: 12px;
        }

        .scan-crosshair::before,
        .scan-crosshair::after {
            content: '';
            position: absolute;
            background: var(--danger);
        }

        .scan-crosshair::before {
            width: 12px; height: 1.5px;
            top: 50%; left: 0;
            transform: translateY(-50%);
        }

        .scan-crosshair::after {
            width: 1.5px; height: 12px;
            left: 50%; top: 0;
            transform: translateX(-50%);
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .scan-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--danger);
            margin-bottom: 8px;
            letter-spacing: 0.05em;
        }

        .scan-detail {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.72rem;
            color: var(--text-dim);
            height: 20px;
        }

        /* CV Document */
        .cv-doc {
            background: #ffffff;
            color: #1a1a2e;
            width: 100%;
            max-width: 640px;
            border-radius: 8px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            padding: 36px 40px;
            display: none;
            position: relative;
        }

        .cv-doc.visible { display: block; }

        .cv-header {
            display: flex;
            align-items: center;
            gap: 18px;
            margin-bottom: 8px;
            opacity: 0;
        }

        .cv-header.animate-in { animation: fadeIn 0.4s ease forwards; }

        .cv-avatar {
            width: 64px; height: 64px;
            border-radius: 50%;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
            background: #e2e8f0;
        }

        .cv-avatar img {
            width: 100%; height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Avatar generation animation */
        .cv-avatar .avatar-gen {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 50%, #e2e8f0 100%);
            background-size: 200% 200%;
            animation: shimmer 1.2s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cv-avatar .avatar-gen svg {
            width: 28px; height: 28px;
            stroke: #94a3b8;
            fill: none;
        }

        .cv-avatar .avatar-gen.done {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes shimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        .cv-name { font-size: 1.45rem; font-weight: 800; color: #0a1628; line-height: 1.2; }

        .cv-contact {
            font-size: 0.7rem;
            color: #64748b;
            margin-top: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px 14px;
        }

        .cv-headline {
            font-size: 0.92rem;
            font-weight: 600;
            color: #3B82F6;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 2px solid #f1f5f9;
            min-height: 1.4em;
            opacity: 0;
            font-family: 'JetBrains Mono', 'Manrope', monospace;
        }

        .cv-headline.animate-in { opacity: 1; }

        .cv-headline .cursor {
            display: inline-block;
            width: 2px; height: 1em;
            background: #3B82F6;
            margin-left: 1px;
            vertical-align: text-bottom;
            animation: blink 0.5s step-end infinite;
        }

        @keyframes blink { 50% { opacity: 0; } }

        /* CV sections */
        .cv-section { margin-bottom: 18px; opacity: 0; }
        .cv-section.animate-in { animation: fadeIn 0.4s ease forwards; }

        .cv-section-title {
            font-size: 0.68rem;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .cv-summary {
            font-size: 0.82rem;
            line-height: 1.65;
            color: #334155;
        }

        .cv-summary .keyword {
            color: #059669;
            font-weight: 600;
        }

        .cv-exp-item {
            margin-bottom: 14px;
            padding-left: 14px;
            border-left: 2px solid #e2e8f0;
            opacity: 0;
            transform: translateX(-10px);
        }

        .cv-exp-item.animate-in { animation: slideInLeft 0.4s ease forwards; }

        @keyframes slideInLeft {
            to { opacity: 1; transform: translateX(0); }
        }

        .cv-exp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }

        .cv-exp-company-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cv-exp-logo {
            height: 16px;
            width: auto;
            opacity: 0.7;
        }

        .cv-exp-company { font-size: 0.88rem; font-weight: 700; color: #0a1628; }

        .cv-exp-period {
            font-size: 0.72rem;
            color: #94a3b8;
            font-weight: 500;
            flex-shrink: 0;
            margin-left: 12px;
        }

        .cv-exp-title {
            font-size: 0.78rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .cv-exp-bullets { list-style: none; padding: 0; }

        .cv-exp-bullets li {
            font-size: 0.76rem;
            color: #475569;
            line-height: 1.55;
            padding-left: 14px;
            position: relative;
            margin-bottom: 2px;
        }

        .cv-exp-bullets li::before {
            content: '';
            position: absolute;
            left: 0; top: 8px;
            width: 4px; height: 4px;
            border-radius: 50%;
            background: #cbd5e1;
        }

        .cv-skills { display: flex; flex-wrap: wrap; gap: 6px; }

        .cv-skill-tag {
            font-size: 0.72rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 5px;
            background: #f1f5f9;
            color: #475569;
            opacity: 0;
            transform: scale(0.7);
        }

        .cv-skill-tag.animate-in { animation: popIn 0.15s ease forwards; }

        .cv-skill-tag.matched {
            background: #ecfdf5;
            color: #059669;
            border: 1px solid #a7f3d0;
        }

        @keyframes popIn { to { opacity: 1; transform: scale(1); } }

        .cv-edu {
            font-size: 0.82rem;
            color: #334155;
            line-height: 1.5;
        }

        .cv-edu strong { font-weight: 700; color: #0a1628; }

        .cv-certs {
            margin-top: 6px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .cv-cert-tag {
            font-size: 0.68rem;
            font-weight: 500;
            padding: 3px 8px;
            border-radius: 4px;
            background: #fef3c7;
            color: #92400e;
        }

        .cv-watermark {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-35deg);
            font-size: 3.5rem;
            font-weight: 800;
            color: rgba(239, 68, 68, 0.05);
            white-space: nowrap;
            pointer-events: none;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* Match score badge */
        .match-badge {
            position: absolute;
            top: 16px; right: 16px;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 6px 12px;
            display: none;
            align-items: center;
            gap: 6px;
        }

        .match-badge.visible { display: flex; }

        .match-score {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: #059669;
        }

        .match-label {
            font-size: 0.65rem;
            font-weight: 600;
            color: #059669;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        /* Generation helpers */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* Warning banner */
        .warning-banner {
            padding: 8px 32px;
            background: var(--danger-dim);
            border-top: 1px solid rgba(239, 68, 68, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.7rem;
            color: var(--danger);
            font-weight: 500;
            flex-shrink: 0;
        }

        .warning-banner svg { width: 12px; height: 12px; flex-shrink: 0; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img class="header-logo" src="https://cdn.prod.website-files.com/68ca65f64a04c90f13846d37/68ca65f64a04c90f13846dfe_Clarity%20Logo.svg" alt="Clarity">
            <div class="header-divider"></div>
            <span class="header-title">Identity Generator</span>
        </div>
        <a href="../../index.html" class="header-back">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
            Back to Hub
        </a>
    </header>

    <!-- Attack Timeline -->
    <div class="attack-timeline">
        <div class="timeline-step" id="step-recon">
            <span class="step-num">1</span>
            <span>Target</span>
        </div>
        <div class="timeline-connector" id="conn-1"></div>
        <div class="timeline-step" id="step-scan">
            <span class="step-num">2</span>
            <span>Extract</span>
        </div>
        <div class="timeline-connector" id="conn-2"></div>
        <div class="timeline-step" id="step-gen">
            <span class="step-num">3</span>
            <span>Generate</span>
        </div>
        <div class="timeline-connector" id="conn-3"></div>
        <div class="timeline-step" id="step-ready">
            <span class="step-num">4</span>
            <span>Deploy</span>
        </div>
        <div class="attack-timer" id="attackTimer">0.0s</div>
    </div>

    <!-- Main content -->
    <div class="main">
        <!-- Left: Target Company -->
        <div class="left-panel">
            <div class="company-header">
                <div class="company-logo-row">
                    <div class="company-icon">VF</div>
                    <span class="company-name">Vero Financial</span>
                </div>
                <div class="company-subtitle">Open positions &middot; careers.verofinancial.com</div>
            </div>
            <div class="jobs-label">Open Positions</div>
            <div class="job-list" id="jobList"></div>
        </div>

        <!-- Right: CV Display -->
        <div class="right-panel" id="rightPanel">
            <div class="placeholder" id="placeholder">
                <div class="placeholder-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/>
                    </svg>
                </div>
                <h3>Select a target role</h3>
                <p>Click a job listing to watch a synthetic identity build in real time</p>
            </div>

            <div class="scan-overlay" id="scanOverlay">
                <div class="scan-ring-outer">
                    <div class="scan-ring"></div>
                    <div class="scan-ring-inner"></div>
                    <div class="scan-crosshair"></div>
                </div>
                <div class="scan-label" id="scanLabel">Extracting requirements...</div>
                <div class="scan-detail" id="scanDetail"></div>
            </div>

            <div class="cv-doc" id="cvDoc">
                <div class="cv-watermark">SYNTHETIC</div>
                <div class="match-badge" id="matchBadge">
                    <span class="match-score" id="matchScore">0%</span>
                    <span class="match-label">match</span>
                </div>
                <div class="cv-header" id="cvHeader">
                    <div class="cv-avatar" id="cvAvatar"></div>
                    <div>
                        <div class="cv-name" id="cvName"></div>
                        <div class="cv-contact" id="cvContact"></div>
                    </div>
                </div>
                <div class="cv-headline" id="cvHeadline"></div>

                <div class="cv-section" id="cvSummarySection">
                    <div class="cv-section-title">Professional Summary</div>
                    <div class="cv-summary" id="cvSummary"></div>
                </div>

                <div class="cv-section" id="cvExpSection">
                    <div class="cv-section-title">Experience</div>
                    <div id="cvExperience"></div>
                </div>

                <div class="cv-section" id="cvSkillsSection">
                    <div class="cv-section-title">Skills</div>
                    <div class="cv-skills" id="cvSkills"></div>
                </div>

                <div class="cv-section" id="cvEduSection">
                    <div class="cv-section-title">Education & Certifications</div>
                    <div class="cv-edu" id="cvEdu"></div>
                    <div class="cv-certs" id="cvCerts"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning -->
    <div class="warning-banner">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
        This is a demonstration of synthetic identity generation for educational purposes only.
    </div>

    <script src="identities.js"></script>
    <script>
    (function() {
        let generationId = 0;
        let activeJobId = null;
        let timerInterval = null;
        let timerStart = 0;

        // Logo map for experience companies
        const LOGO_MAP = {
            stripe: '../../shared/logos/stripe.svg',
            plaid: '../../shared/logos/plaid.svg',
            crowdstrike: '../../shared/logos/crowdstrike.svg',
            okta: '../../shared/logos/okta.svg',
            splunk: '../../shared/logos/splunk.svg',
            jira: '../../shared/logos/jira.svg',
            elastic: '../../shared/logos/elastic.svg'
        };

        // ── Timer ──
        const timerEl = document.getElementById('attackTimer');

        function startTimer() {
            timerStart = performance.now();
            timerEl.className = 'attack-timer running';
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const elapsed = ((performance.now() - timerStart) / 1000).toFixed(1);
                timerEl.textContent = elapsed + 's';
            }, 100);
        }

        function stopTimer() {
            if (timerInterval) clearInterval(timerInterval);
            const elapsed = ((performance.now() - timerStart) / 1000).toFixed(1);
            timerEl.textContent = elapsed + 's';
            timerEl.className = 'attack-timer finished';
        }

        // ── Timeline ──
        function resetTimeline() {
            ['step-recon', 'step-scan', 'step-gen', 'step-ready'].forEach(id => {
                document.getElementById(id).className = 'timeline-step';
            });
            ['conn-1', 'conn-2', 'conn-3'].forEach(id => {
                document.getElementById(id).className = 'timeline-connector';
            });
            timerEl.className = 'attack-timer';
        }

        function setTimelineStep(stepNum) {
            const steps = ['step-recon', 'step-scan', 'step-gen', 'step-ready'];
            const conns = ['conn-1', 'conn-2', 'conn-3'];

            steps.forEach((id, i) => {
                const el = document.getElementById(id);
                if (i + 1 < stepNum) el.className = 'timeline-step done';
                else if (i + 1 === stepNum) el.className = 'timeline-step active';
                else el.className = 'timeline-step';
            });

            conns.forEach((id, i) => {
                const el = document.getElementById(id);
                if (i + 1 < stepNum) el.className = 'timeline-connector done';
                else if (i + 1 === stepNum) el.className = 'timeline-connector active';
                else el.className = 'timeline-connector';
            });
        }

        // ── Render job listings ──
        const jobList = document.getElementById('jobList');
        window.JOB_LISTINGS.forEach(job => {
            const card = document.createElement('div');
            card.className = 'job-card';
            card.dataset.jobId = job.id;
            const reqTags = (job.requirements || []).map(r => {
                const label = typeof r === 'string' ? r : r.label;
                return '<span class="req-tag" data-req="' + label + '">' + label + '</span>';
            }).join('');
            card.innerHTML = `
                <div class="job-title">${job.title}</div>
                <div class="job-team">${job.team}</div>
                <div class="job-meta">
                    <span>
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        ${job.location}
                    </span>
                    <span>
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        ${job.posted}
                    </span>
                </div>
                <div class="job-requirements">${reqTags}</div>
            `;
            card.addEventListener('click', () => selectJob(job.id));
            jobList.appendChild(card);
        });

        // ── Select job ──
        function selectJob(jobId) {
            if (activeJobId === jobId) return;
            activeJobId = jobId;
            generationId++;
            const thisGen = generationId;

            document.querySelectorAll('.job-card').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-job-id="${jobId}"]`).classList.add('active');

            // Reset requirement tag highlights
            document.querySelectorAll('.req-tag').forEach(t => t.classList.remove('extracted'));

            generateCV(jobId, thisGen);
        }

        // ── Main generation sequence ──
        async function generateCV(jobId, genId) {
            const identity = window.IDENTITIES[jobId];
            const job = window.JOB_LISTINGS.find(j => j.id === jobId);
            if (!identity || !job) return;

            const placeholder = document.getElementById('placeholder');
            const scanOverlay = document.getElementById('scanOverlay');
            const cvDoc = document.getElementById('cvDoc');
            const matchBadge = document.getElementById('matchBadge');

            // Reset
            placeholder.style.display = 'none';
            cvDoc.classList.remove('visible');
            matchBadge.classList.remove('visible');
            resetCV();
            resetTimeline();

            // ── Step 1: Target selected ──
            setTimelineStep(1);
            startTimer();
            await delay(400);
            if (genId !== generationId) return;

            // ── Step 2: Extract requirements ──
            setTimelineStep(2);
            scanOverlay.classList.add('active');
            document.getElementById('scanLabel').textContent = 'Extracting requirements...';

            // Highlight requirement tags one by one
            const reqTags = document.querySelectorAll(`[data-job-id="${jobId}"] .req-tag`);
            for (let i = 0; i < reqTags.length; i++) {
                if (genId !== generationId) return;
                const tag = reqTags[i];
                tag.classList.add('extracted');
                document.getElementById('scanDetail').textContent = tag.dataset.req;
                await delay(200);
            }

            if (genId !== generationId) return;
            document.getElementById('scanLabel').textContent = 'Building identity...';
            document.getElementById('scanDetail').textContent = job.requirements.length + ' requirements matched';
            await delay(600);
            if (genId !== generationId) return;

            scanOverlay.classList.remove('active');

            // ── Step 3: Generate CV ──
            setTimelineStep(3);
            cvDoc.classList.add('visible');

            // 3a: Header with photo
            const cvHeader = document.getElementById('cvHeader');
            const cvAvatar = document.getElementById('cvAvatar');
            const cvName = document.getElementById('cvName');
            const cvContact = document.getElementById('cvContact');

            // Show avatar with generation animation, then reveal photo
            if (identity.avatar) {
                cvAvatar.innerHTML = '<div class="avatar-gen"><svg viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0"/></svg></div><img src="' + identity.avatar + '" alt="" style="opacity:0;transition:opacity 0.4s">';
            } else {
                cvAvatar.style.background = identity.color;
                cvAvatar.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-weight:800;font-size:1.3rem;color:white">' + identity.initials + '</div>';
            }

            cvName.textContent = identity.name;
            cvContact.innerHTML = `
                <span>${identity.email}</span>
                <span>${identity.phone}</span>
                <span>${identity.location}</span>
            `;
            cvHeader.classList.add('animate-in');
            await delay(300);
            if (genId !== generationId) return;

            // Reveal photo
            if (identity.avatar) {
                const genOverlay = cvAvatar.querySelector('.avatar-gen');
                const img = cvAvatar.querySelector('img');
                if (genOverlay) genOverlay.classList.add('done');
                if (img) img.style.opacity = '1';
            }
            await delay(200);
            if (genId !== generationId) return;

            // 3b: Headline typewriter
            const cvHeadline = document.getElementById('cvHeadline');
            cvHeadline.classList.add('animate-in');
            await typewriter(cvHeadline, identity.headline, 15, genId);
            if (genId !== generationId) return;

            // 3c: Summary
            const cvSummarySection = document.getElementById('cvSummarySection');
            const cvSummary = document.getElementById('cvSummary');
            cvSummarySection.classList.add('animate-in');
            await typewriterHTML(cvSummary, identity.summary, identity.keywords, 6, genId);
            if (genId !== generationId) return;

            // 3d: Experience
            const cvExpSection = document.getElementById('cvExpSection');
            const cvExperience = document.getElementById('cvExperience');
            cvExpSection.classList.add('animate-in');
            await delay(80);
            if (genId !== generationId) return;

            for (const exp of identity.experience) {
                if (genId !== generationId) return;
                const item = document.createElement('div');
                item.className = 'cv-exp-item';

                const logoHtml = exp.logo && LOGO_MAP[exp.logo]
                    ? '<img class="cv-exp-logo" src="' + LOGO_MAP[exp.logo] + '" alt="">'
                    : '';

                item.innerHTML = `
                    <div class="cv-exp-header">
                        <div class="cv-exp-company-row">
                            ${logoHtml}
                            <span class="cv-exp-company">${exp.company}</span>
                        </div>
                        <span class="cv-exp-period">${exp.period}</span>
                    </div>
                    <div class="cv-exp-title">${exp.title}</div>
                    <ul class="cv-exp-bullets">
                        ${exp.bullets.map(b => '<li>' + b + '</li>').join('')}
                    </ul>
                `;
                cvExperience.appendChild(item);
                await delay(40);
                if (genId !== generationId) return;
                item.classList.add('animate-in');
                await delay(350);
                if (genId !== generationId) return;
            }

            // 3e: Skills
            const cvSkillsSection = document.getElementById('cvSkillsSection');
            const cvSkills = document.getElementById('cvSkills');
            cvSkillsSection.classList.add('animate-in');

            let matchCount = 0;
            const totalSkills = identity.skills.length;

            for (const skill of identity.skills) {
                if (genId !== generationId) return;
                const tag = document.createElement('span');
                tag.className = 'cv-skill-tag' + (skill.matched ? ' matched' : '');
                tag.textContent = skill.name;
                cvSkills.appendChild(tag);
                await delay(15);
                if (genId !== generationId) return;
                tag.classList.add('animate-in');
                if (skill.matched) matchCount++;
                await delay(60);
                if (genId !== generationId) return;
            }

            // Show match score
            const score = Math.round((matchCount / totalSkills) * 100);
            const matchScoreEl = document.getElementById('matchScore');
            matchBadge.classList.add('visible');
            // Animate score counting up
            for (let i = 0; i <= score; i += 3) {
                if (genId !== generationId) return;
                matchScoreEl.textContent = Math.min(i, score) + '%';
                await delay(15);
            }
            matchScoreEl.textContent = score + '%';

            // 3f: Education
            const cvEduSection = document.getElementById('cvEduSection');
            const cvEdu = document.getElementById('cvEdu');
            const cvCerts = document.getElementById('cvCerts');

            cvEdu.innerHTML = `
                <strong>${identity.education.degree}</strong><br>
                ${identity.education.school} &middot; ${identity.education.year}
            `;
            cvCerts.innerHTML = identity.certifications
                .map(c => '<span class="cv-cert-tag">' + c + '</span>')
                .join('');
            cvEduSection.classList.add('animate-in');

            await delay(200);
            if (genId !== generationId) return;

            // ── Step 4: Ready to deploy ──
            setTimelineStep(4);
            stopTimer();
        }

        // ── Helpers ──
        function delay(ms) {
            return new Promise(r => setTimeout(r, ms));
        }

        async function typewriter(el, text, charDelay, genId) {
            el.innerHTML = '<span class="cursor"></span>';
            for (let i = 0; i < text.length; i++) {
                if (genId !== generationId) return;
                el.innerHTML = text.substring(0, i + 1) + '<span class="cursor"></span>';
                await delay(charDelay);
            }
            await delay(300);
            if (genId !== generationId) return;
            el.textContent = text;
        }

        async function typewriterHTML(el, text, keywords, charDelay, genId) {
            el.textContent = '';
            let result = '';
            for (let i = 0; i < text.length; i++) {
                if (genId !== generationId) return;
                result += text[i];
                if (i % 3 === 0 || i === text.length - 1) {
                    el.textContent = result;
                    await delay(charDelay);
                }
            }
            if (genId !== generationId) return;
            let highlighted = text;
            keywords.forEach(kw => {
                const regex = new RegExp('(' + escapeRegex(kw) + ')', 'gi');
                highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
            });
            el.innerHTML = highlighted;
        }

        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function resetCV() {
            document.querySelectorAll('.animate-in').forEach(el => el.classList.remove('animate-in'));
            document.getElementById('cvHeadline').textContent = '';
            document.getElementById('cvHeadline').classList.remove('animate-in');
            document.getElementById('cvSummary').textContent = '';
            document.getElementById('cvExperience').innerHTML = '';
            document.getElementById('cvSkills').innerHTML = '';
            document.getElementById('cvEdu').innerHTML = '';
            document.getElementById('cvCerts').innerHTML = '';
            document.getElementById('cvAvatar').innerHTML = '';
            document.getElementById('cvAvatar').style.background = '';
        }
    })();
    </script>
    <script src="../../shared/js/dev-mode.js"></script>
</body>
</html>
